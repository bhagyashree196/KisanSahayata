{% extends "base.html" %}
{% block title %}Kisan Sahayata - Farmer Support Portal{% endblock %}

{% block navbar %}
<nav class="navbar navbar-expand-lg navbar-dark bg-success sticky-top py-2">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="/">
      <img src="{{ url_for('static', filename='images/logo.png') }}" class="rounded-circle me-2" width="40" height="40" alt="Kisan Sahayata Logo" onerror="this.src='https://via.placeholder.com/40x40/2e7d32/ffffff?text=üåæ'">
      <span class="fw-bold fs-4"></span>Kisan Sahayata</span>
    </a>
    
    <div class="d-flex align-items-center gap-2">
      <select id="languageSwitcher" class="form-select form-select-sm bg-light border-0" style="width:120px; border-radius:20px;">
        <option value="en"> English</option>
        <option value="hi"> ‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
        <option value="mr"> ‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
      </select>
      <a href="{{ url_for('admin_login') }}" class="btn btn-outline-light btn-sm px-3" style="border-radius:20px;">
        <i class="fas fa-lock me-1"></i>Admin
      </a>
    </div>
  </div>
</nav>

<!-- Helpline Info Bar -->

{% endblock %}

{% block content %}

<!-- HERO -->
<section class="hero-section">
  <div class="container text-center">
    <h1 id="welcomeText" class="hero-title">üåæ Kisan Sahayata</h1>
    <p class="hero-subtitle" id="heroSubtitle">Empowering Farmers with Government Schemes & Financial Support</p>
    <div class="row justify-content-center mt-4">
         
      </div>
</div>
</section>

<!-- STATS -->
<div class="container stats-section">
  <div class="row g-3 text-center" id="statsRow">
    <div class="col"><div class="stat-card"><i class="fas fa-file-alt stat-icon"></i><div class="stat-number" id="statTotal">--</div><div class="stat-label">Total Schemes</div></div></div>
    <div class="col"><div class="stat-card"><i class="fas fa-landmark stat-icon"></i><div class="stat-number" id="statGovt">--</div><div class="stat-label">Govt Schemes</div></div></div>
    <div class="col"><div class="stat-card"><i class="fas fa-coins stat-icon"></i><div class="stat-number" id="statFin">--</div><div class="stat-label">Financial</div></div></div>
    <div class="col"><div class="stat-card"><i class="fas fa-shield-alt stat-icon"></i><div class="stat-number" id="statIns">--</div><div class="stat-label">Insurance</div></div></div>
    <div class="col"><div class="stat-card"><i class="fas fa-check-circle stat-icon"></i><div class="stat-number" id="statActive">--</div><div class="stat-label">Active</div></div></div>
  </div>
</div>

<!-- FEATURE CARDS -->
<div class="container mt-5">
  <div class="row g-4">
    <div class="col-md-4">
      <a href="javascript:void(0)" class="feature-card" data-bs-toggle="modal" data-bs-target="#schemeModal">
        <div class="feature-icon"><i class="fas fa-landmark"></i></div>
        <h3>üìã Government Schemes</h3>
        <p>Explore PM-KISAN, RKVY, Maharashtra state schemes and more with eligibility and application details.</p>
        <span class="badge bg-success">Central</span>
        <span class="badge bg-primary">Maharashtra</span>
      </a>
    </div>
    <div class="col-md-4">
      <a href="javascript:void(0)" class="feature-card" data-bs-toggle="modal" data-bs-target="#financialModal">
        <div class="feature-icon"><i class="fas fa-coins"></i></div>
        <h3>üí∞ Financial Support</h3>
        <p>Discover KCC loans, PM-KMY pension, AIF infrastructure fund and subsidy programs at low interest.</p>
        <span class="badge bg-success">Loans</span>
        <span class="badge bg-primary">Subsidies</span>
      </a>
    </div>
    <div class="col-md-4">
      <a href="javascript:void(0)" class="feature-card" data-bs-toggle="modal" data-bs-target="#insuranceModal">
        <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
        <h3>üõ°Ô∏è Insurance</h3>
        <p>Get PMFBY crop insurance, life insurance and relief schemes to protect against unexpected losses.</p>
        <span class="badge bg-success">Crop</span>
        <span class="badge bg-primary">Life</span>
      </a>
    </div>
  </div>
</div>

<!-- QUICK LINKS -->
<div class="container quick-links mt-5">
  <h2 class="section-title text-center mb-4">‚ö° Quick Access</h2>
  <div class="row g-3">
    <div class="col-md-6">
      <a href="{{ url_for('govscheme') }}" class="link-card">
        <i class="fas fa-seedling link-icon text-success"></i>
        <div class="link-content">
          <h5>PM-KISAN Scheme</h5>
          <p class="text-muted mb-0">Direct income support of ‚Çπ6000/year</p>
        </div>
        <i class="fas fa-chevron-right ms-auto text-muted"></i>
      </a>
    </div>
    <div class="col-md-6">
      <a href="{{ url_for('insurance') }}" class="link-card">
        <i class="fas fa-umbrella link-icon text-primary"></i>
        <div class="link-content">
          <h5>Crop Insurance (PMFBY)</h5>
          <p class="text-muted mb-0">Protect your crops against losses</p>
        </div>
        <i class="fas fa-chevron-right ms-auto text-muted"></i>
      </a>
    </div>
    <div class="col-md-6">
      <a href="{{ url_for('financial') }}" class="link-card">
        <i class="fas fa-credit-card link-icon text-warning"></i>
        <div class="link-content">
          <h5>Kisan Credit Card</h5>
          <p class="text-muted mb-0">Easy loans at 4% interest</p>
        </div>
        <i class="fas fa-chevron-right ms-auto text-muted"></i>
      </a>
    </div>
    <div class="col-md-6">
      <a href="{{ url_for('govscheme') }}" class="link-card">
        <i class="fas fa-water link-icon text-info"></i>
        <div class="link-content">
          <h5>Irrigation Schemes</h5>
          <p class="text-muted mb-0">Subsidy for drip/sprinkler systems</p>
        </div>
        <i class="fas fa-chevron-right ms-auto text-muted"></i>
      </a>
    </div>
  </div>
</div>

<!-- TESTIMONIALS WITH REAL IMAGES -->
<div class="container mb-5 mt-5">
  <h2 class="section-title text-center mb-4">üòä Happy Farmers</h2>
  <div class="row g-4">
    <div class="col-md-4">
      <div class="card testimonial-card h-100 border-0 shadow-sm">
        <div class="card-body text-center">
          <img src="https://randomuser.me/api/portraits/men/32.jpg" class="rounded-circle mb-3" width="80" height="80" alt="Ram Singh">
          <h5>Ram Singh</h5>
          <p class="text-muted">"Got PM-KISAN benefits easily through this portal"</p>
          <div class="text-warning">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
          <small class="text-success">Farmer, Jalna</small>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card testimonial-card h-100 border-0 shadow-sm">
        <div class="card-body text-center">
          <img src="https://randomuser.me/api/portraits/women/44.jpg" class="rounded-circle mb-3" width="80" height="80" alt="Shanta Bai">
          <h5>Shanta Bai</h5>
          <p class="text-muted">"Understood KCC loan process in my language"</p>
          <div class="text-warning">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
          <small class="text-success">Farmer, Nashik</small>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card testimonial-card h-100 border-0 shadow-sm">
        <div class="card-body text-center">
          <img src="https://randomuser.me/api/portraits/men/46.jpg" class="rounded-circle mb-3" width="80" height="80" alt="Rajesh Patil">
          <h5>Rajesh Patil</h5>
          <p class="text-muted">"Applied for PMFBY crop insurance in Marathi, very helpful!"</p>
          <div class="text-warning">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
          <small class="text-success">Farmer, Sangli</small>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ‚îÄ (Keep existing modals unchanged) -->
<!-- Govt Scheme Modal -->
<div class="modal fade" id="schemeModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4">
      <div class="modal-header bg-success text-white rounded-top-4">
        <h5 class="modal-title fw-bold">üåæ Select Scheme Type</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4">
        <form id="schemeForm">
          <div class="mb-3">
            <label class="form-label fw-semibold">Farmer Name</label>
            <input type="text" class="form-control" id="farmerName" placeholder="Enter your name" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Location (District/Village)</label>
            <input type="text" class="form-control" id="farmerLocation" placeholder="Enter district or village" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Scheme Type</label>
            <select class="form-select" id="schemeType" required>
              <option value="" disabled selected>-- Select Scheme Type --</option>
              <option value="Central">Central</option>
              <option value="Maharashtra">State (Maharashtra)</option>
              <option value="All">All Schemes</option>
            </select>
          </div>
          <button type="submit" class="btn btn-success w-100 fw-bold py-2 rounded-pill">
            View Schemes <i class="fas fa-arrow-right ms-1"></i>
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Financial Modal -->
<div class="modal fade" id="financialModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4">
      <div class="modal-header bg-success text-white rounded-top-4">
        <h5 class="modal-title fw-bold">üí∞ Financial Support</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4">
        <form id="financialForm">
          <div class="mb-3">
            <label class="form-label fw-semibold">Farmer Name</label>
            <input type="text" class="form-control" id="financialFarmerName" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Location</label>
            <input type="text" class="form-control" id="financialLocation" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Support Type</label>
            <select class="form-select" id="financialType" required>
              <option value="" disabled selected>-- Select Type --</option>
              <option value="Central">Central</option>
              <option value="Maharashtra">Maharashtra</option>
              <option value="All">All</option>
            </select>
          </div>
          <button type="submit" class="btn btn-success w-100 fw-bold py-2 rounded-pill">
            View Financial Schemes <i class="fas fa-arrow-right ms-1"></i>
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Insurance Modal -->
<div class="modal fade" id="insuranceModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4">
      <div class="modal-header bg-success text-white rounded-top-4">
        <h5 class="modal-title fw-bold">üõ°Ô∏è Insurance Schemes</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-4">
        <form id="insuranceForm">
          <div class="mb-3">
            <label class="form-label fw-semibold">Farmer Name</label>
            <input type="text" class="form-control" id="insuranceFarmerName" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Location</label>
            <input type="text" class="form-control" id="insuranceLocation" required>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Insurance Type</label>
            <select class="form-select" id="insuranceType" required>
              <option value="" disabled selected>-- Select Type --</option>
              <option value="Central">Central</option>
              <option value="Maharashtra">Maharashtra</option>
              <option value="All">All</option>
            </select>
          </div>
          <button type="submit" class="btn btn-success w-100 fw-bold py-2 rounded-pill">
            View Insurance <i class="fas fa-arrow-right ms-1"></i>
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// Load live stats from API
fetch('/api/schemes').then(r=>r.json()).then(all=>{
  document.getElementById('statTotal').textContent = all.length + '+';
  document.getElementById('statActive').textContent = all.length + '+';
  document.getElementById('statGovt').textContent = all.filter(s=>s.category==='govt').length + '+';
  document.getElementById('statFin').textContent = all.filter(s=>s.category==='financial').length + '+';
  document.getElementById('statIns').textContent = all.filter(s=>s.category==='insurance').length + '+';
});

// Form handlers
document.getElementById('schemeForm').addEventListener('submit', function(e){
  e.preventDefault();
  const t = document.getElementById('schemeType').value;
  localStorage.setItem('schemeType', t);
  window.location.href = '/govscheme?type=' + t;
});
document.getElementById('financialForm').addEventListener('submit', function(e){
  e.preventDefault();
  window.location.href = '/financial?type=' + document.getElementById('financialType').value;
});
document.getElementById('insuranceForm').addEventListener('submit', function(e){
  e.preventDefault();
  window.location.href = '/insurance?type=' + document.getElementById('insuranceType').value;
});

// Search
function performSearch() {
  const q = document.getElementById('searchInput').value.trim().toLowerCase();
  if (!q) return;
  fetch('/api/schemes').then(r=>r.json()).then(schemes=>{
    const found = schemes.filter(s =>
      s.title.toLowerCase().includes(q) || (s.tags||'').toLowerCase().includes(q) || (s.description||'').toLowerCase().includes(q)
    );
    const div = document.getElementById('searchResults');
    if (found.length === 0) {
      div.innerHTML = '<div class="alert alert-warning mt-2">No schemes found. Try different keywords.</div>';
    } else {
      div.innerHTML = `<div class="alert alert-success mt-2">Found <b>${found.length}</b> scheme(s): ` +
        found.slice(0,3).map(s=>`<a href="/scheme_detail?id=${s.id}" class="badge bg-success text-decoration-none me-1">${s.title}</a>`).join('') +
        (found.length>3 ? `<span class="text-muted">+ ${found.length-3} more</span>` : '') + '</div>';
    }
  });
}
document.getElementById('searchInput').addEventListener('keypress', e => { if(e.key==='Enter') performSearch(); });
</script>
{% endblock %}